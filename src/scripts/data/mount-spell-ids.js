/**
 * Mount Spell ID Mapping
 *
 * Provides access to the mount ID → spell ID mapping generated by the scraper.
 * This mapping is used to link mounts to their correct Wowhead spell tooltips.
 */

let spellIdMapping = null;

/**
 * Load and cache the spell ID mapping
 */
async function loadSpellIdMapping() {
  if (spellIdMapping) {
    return spellIdMapping;
  }

  try {
    const response = await fetch('data/mount-spell-ids.json');
    if (!response.ok) {
      console.warn(`Failed to load spell ID mapping: ${response.status}`);
      return {};
    }
    spellIdMapping = await response.json();
    console.log(`✅ Loaded ${Object.keys(spellIdMapping).length} spell ID mappings`);
    return spellIdMapping;
  } catch (error) {
    console.error('Error loading spell ID mapping:', error);
    return {};
  }
}

/**
 * Get the spell ID for a given mount ID
 * @param {number} mountId - The mount ID from the Blizzard API
 * @returns {Promise<number>} The spell ID for Wowhead tooltips
 */
export async function getMountSpellId(mountId) {
  const mapping = await loadSpellIdMapping();
  const mountData = mapping[mountId];

  // Handle both old format (just spell ID) and new format (object with spellId and icon)
  if (typeof mountData === 'object' && mountData !== null) {
    return mountData.spellId || mountId;
  }
  return mountData || mountId;
}

/**
 * Get the icon filename for a given mount ID
 * @param {number} mountId - The mount ID from the Blizzard API
 * @returns {Promise<string|null>} The icon filename or null if not found
 */
export async function getMountIcon(mountId) {
  const mapping = await loadSpellIdMapping();
  const mountData = mapping[mountId];

  // Only return icon if we have the new format with icon data
  if (typeof mountData === 'object' && mountData !== null) {
    return mountData.icon || null;
  }
  return null;
}

/**
 * Check if a mount has a mapped spell ID
 * @param {number} mountId - The mount ID to check
 * @returns {Promise<boolean>} True if the mount has a mapped spell ID
 */
export async function hasMappedSpellId(mountId) {
  const mapping = await loadSpellIdMapping();
  return mountId in mapping;
}

/**
 * Get all spell ID mappings
 * @returns {Promise<Object>} The complete mapping object
 */
export async function getAllSpellIdMappings() {
  return await loadSpellIdMapping();
}
