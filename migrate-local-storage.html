<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Migrate LocalStorage Data</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #1a1a1a;
      color: white;
    }
    .section {
      background: rgba(255, 255, 255, 0.05);
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    h1 { color: #148eff; }
    h2 { color: #148eff; font-size: 18px; }
    button {
      background: #148eff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      margin: 5px;
      font-size: 14px;
    }
    button:hover { background: #0d7de8; }
    button.danger { background: #ff4444; }
    button.danger:hover { background: #cc0000; }
    pre {
      background: rgba(0, 0, 0, 0.3);
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
    }
    .status {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
    }
    .status.success { background: rgba(0, 255, 0, 0.1); border: 1px solid green; }
    .status.error { background: rgba(255, 0, 0, 0.1); border: 1px solid red; }
    .status.info { background: rgba(0, 150, 255, 0.1); border: 1px solid #148eff; }
    input {
      width: 100%;
      padding: 10px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: white;
      border-radius: 4px;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <h1>üîß LocalStorage Migration Tool</h1>
  <p>This tool helps migrate your todos and YouTube channels to the new user-specific storage system.</p>

  <div class="section">
    <h2>Step 1: Check Current Data</h2>
    <button onclick="checkData()">üîç Check LocalStorage</button>
    <div id="check-results"></div>
  </div>

  <div class="section">
    <h2>Step 2: Enter Your Battle.net BattleTag</h2>
    <p>Format: <code>YourName#1234</code></p>
    <input type="text" id="battletag" placeholder="e.g., crbntyp#1234">
    <div id="battletag-error"></div>
  </div>

  <div class="section">
    <h2>Step 3: Migrate Data</h2>
    <button onclick="migrateTodos()">üì¶ Migrate Todos</button>
    <button onclick="migrateYouTube()">üì∫ Migrate YouTube Channels</button>
    <button onclick="migrateAll()">‚ú® Migrate All</button>
    <div id="migrate-results"></div>
  </div>

  <div class="section">
    <h2>Step 4: View All Keys (Debug)</h2>
    <button onclick="viewAllKeys()">üîë View All LocalStorage Keys</button>
    <div id="all-keys"></div>
  </div>

  <script>
    function checkData() {
      const results = document.getElementById('check-results');

      const oldTodos = localStorage.getItem('guild_todos');
      const oldYouTube = localStorage.getItem('guild_youtube_channels');

      let html = '<div class="status info">';
      html += '<strong>Old Storage (before migration):</strong><br>';
      html += `Todos: ${oldTodos ? JSON.parse(oldTodos).length + ' items found' : 'None'}<br>`;
      html += `YouTube: ${oldYouTube ? JSON.parse(oldYouTube).length + ' channels found' : 'None'}`;
      html += '</div>';

      if (oldTodos) {
        html += '<pre>' + JSON.stringify(JSON.parse(oldTodos), null, 2).substring(0, 500) + '...</pre>';
      }

      results.innerHTML = html;
    }

    function getBattleTag() {
      const battletag = document.getElementById('battletag').value.trim();
      const errorDiv = document.getElementById('battletag-error');

      if (!battletag) {
        errorDiv.innerHTML = '<div class="status error">Please enter your BattleTag</div>';
        return null;
      }

      if (!battletag.includes('#')) {
        errorDiv.innerHTML = '<div class="status error">BattleTag must include # (e.g., YourName#1234)</div>';
        return null;
      }

      errorDiv.innerHTML = '';
      return battletag;
    }

    function getUserKey(battletag, type) {
      return `guild_${type}_${battletag.replace('#', '_')}`;
    }

    function migrateTodos() {
      const battletag = getBattleTag();
      if (!battletag) return;

      const results = document.getElementById('migrate-results');
      const oldTodos = localStorage.getItem('guild_todos');

      if (!oldTodos) {
        results.innerHTML = '<div class="status info">No old todos found to migrate</div>';
        return;
      }

      const newKey = getUserKey(battletag, 'todos');
      localStorage.setItem(newKey, oldTodos);

      results.innerHTML = `
        <div class="status success">
          ‚úÖ Migrated ${JSON.parse(oldTodos).length} todos to: <code>${newKey}</code><br>
          Old key kept for backup: <code>guild_todos</code>
        </div>
      `;
    }

    function migrateYouTube() {
      const battletag = getBattleTag();
      if (!battletag) return;

      const results = document.getElementById('migrate-results');
      const oldYouTube = localStorage.getItem('guild_youtube_channels');

      if (!oldYouTube) {
        results.innerHTML = '<div class="status info">No old YouTube channels found to migrate</div>';
        return;
      }

      const newKey = getUserKey(battletag, 'youtube_channels');
      localStorage.setItem(newKey, oldYouTube);

      results.innerHTML = `
        <div class="status success">
          ‚úÖ Migrated ${JSON.parse(oldYouTube).length} channels to: <code>${newKey}</code><br>
          Old key kept for backup: <code>guild_youtube_channels</code>
        </div>
      `;
    }

    function migrateAll() {
      const battletag = getBattleTag();
      if (!battletag) return;

      migrateTodos();
      setTimeout(() => {
        migrateYouTube();
      }, 100);
    }

    function viewAllKeys() {
      const allKeys = document.getElementById('all-keys');
      let html = '<div class="status info"><strong>All LocalStorage Keys:</strong><br><br>';

      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith('guild_')) {
          const value = localStorage.getItem(key);
          let preview = '';
          try {
            const parsed = JSON.parse(value);
            if (Array.isArray(parsed)) {
              preview = ` (${parsed.length} items)`;
            }
          } catch {}
          html += `<code>${key}</code>${preview}<br>`;
        }
      }

      html += '</div>';
      allKeys.innerHTML = html;
    }
  </script>
</body>
</html>
